<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Securing FastAPI with JWKS (AWS Cognito, Auth0) | anthony lukach</title>
<meta name=keywords content="auth,fastapi,python"><meta name=description content="This post is a quick capture of how to easily secure your FastAPI with any auth provider that provides JWKS.
Background: RS256 RS256 is a signing algorithm used to generate and validate JSON Web Tokens (JWTs). Unlike the common HS256 algorithm that uses the same secret string to both generate and validate JWTs, RS256 uses a private key to generate JWTs and a separate public key for validating JWTs:
RS256 generates an asymmetric signature, which means a private key must be used to sign the JWT and a different public key must be used to verify the signature."><meta name=author content><link rel=canonical href=https://alukach.com/posts/fastapi-rs256-jwt/><link crossorigin=anonymous href=/assets/css/stylesheet.min.4ba82eb0954ce20ea51d7ca6c3b71ea48dd719c880f27386be309802fedc6b21.css integrity="sha256-S6gusJVM4g6lHXymw7cepI3XGciA8nOGvjCYAv7cayE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://alukach.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://alukach.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://alukach.com/favicon-32x32.png><link rel=apple-touch-icon href=https://alukach.com/apple-touch-icon.png><link rel=mask-icon href=https://alukach.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://alukach.com/posts/fastapi-rs256-jwt/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-16401510-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Securing FastAPI with JWKS (AWS Cognito, Auth0)"><meta property="og:description" content="This post is a quick capture of how to easily secure your FastAPI with any auth provider that provides JWKS.
Background: RS256 RS256 is a signing algorithm used to generate and validate JSON Web Tokens (JWTs). Unlike the common HS256 algorithm that uses the same secret string to both generate and validate JWTs, RS256 uses a private key to generate JWTs and a separate public key for validating JWTs:
RS256 generates an asymmetric signature, which means a private key must be used to sign the JWT and a different public key must be used to verify the signature."><meta property="og:type" content="article"><meta property="og:url" content="https://alukach.com/posts/fastapi-rs256-jwt/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-27T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Securing FastAPI with JWKS (AWS Cognito, Auth0)"><meta name=twitter:description content="This post is a quick capture of how to easily secure your FastAPI with any auth provider that provides JWKS.
Background: RS256 RS256 is a signing algorithm used to generate and validate JSON Web Tokens (JWTs). Unlike the common HS256 algorithm that uses the same secret string to both generate and validate JWTs, RS256 uses a private key to generate JWTs and a separate public key for validating JWTs:
RS256 generates an asymmetric signature, which means a private key must be used to sign the JWT and a different public key must be used to verify the signature."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://alukach.com/posts/"},{"@type":"ListItem","position":2,"name":"Securing FastAPI with JWKS (AWS Cognito, Auth0)","item":"https://alukach.com/posts/fastapi-rs256-jwt/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Securing FastAPI with JWKS (AWS Cognito, Auth0)","name":"Securing FastAPI with JWKS (AWS Cognito, Auth0)","description":"This post is a quick capture of how to easily secure your FastAPI with any auth provider that provides JWKS.\nBackground: RS256 RS256 is a signing algorithm used to generate and validate JSON Web Tokens (JWTs). Unlike the common HS256 algorithm that uses the same secret string to both generate and validate JWTs, RS256 uses a private key to generate JWTs and a separate public key for validating JWTs:\nRS256 generates an asymmetric signature, which means a private key must be used to sign the JWT and a different public key must be used to verify the signature.","keywords":["auth","fastapi","python"],"articleBody":"This post is a quick capture of how to easily secure your FastAPI with any auth provider that provides JWKS.\nBackground: RS256 RS256 is a signing algorithm used to generate and validate JSON Web Tokens (JWTs). Unlike the common HS256 algorithm that uses the same secret string to both generate and validate JWTs, RS256 uses a private key to generate JWTs and a separate public key for validating JWTs:\nRS256 generates an asymmetric signature, which means a private key must be used to sign the JWT and a different public key must be used to verify the signature. [source]\nThis allows you to share your public key and thus enables any service to validate JWTs (provided that the service can read the public key). This makes RS256 a great choice for distributed applications, wherein one service generates auth tokens but many services can independently validate auth tokens.\nNote: You are already using asymmetric cryptographic algorithms. For example, when you access a website over HTTPS, the SSL certificate includes a public key to allow a browser to validate messages sent by the origin server, while the origin server maintains a private key used to sign messages before they are sent. Additionally, when you set up SSH key pair for the purpose of connecting to servers, this key pair consists of a private and public key. The private is kept on your machine while a public key can be stored in a ~/.ssh/authorized_keys file on the server to validate login requests.\nBackground: JWKS The JSON Web Key Set (JWKS) is a set of keys containing the public keys used to verify any JSON Web Token (JWT) issued by the authorization server and signed using the RS256 signing algorithm. [source]\nThe JWKS is needed by each service that will be validating tokens. It can be commonly be found at /.well-known/jwks.json, however theoretically could be distributed in any other means (S3, AWS Parameter Store, etc).\nJWKS Locations Provider Location Example Cognito https://cognito-idp.{region}.amazonaws.com/{user_pool_id}/.well-known/jwks.json https://cognito-idp.us-east-1.amazonaws.com/us-east-1_Wt2sA2K9e/.well-known/jwks.json Auth0 https://YOUR_DOMAIN/.well-known/jwks.json https://example.auth0.com/.well-known/jwks.json FastAPI Integration For a FastAPI application to validate a JWT signed with an RS256 algorithm, it needs to do the following:\nLoad JWKS Retrieve token from the request Validate the tokenâ€™s signature against the JWKS Below, Iâ€™ve added a simple way to achieve this by taking advantage of FastAPIâ€™s dependency injection system and pyJWT:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 from typing import Annotated, Any, Dict, List, Optional import jwt from fastapi import FastAPI, HTTPException, Security, security, status from pydantic import HttpUrl from pydantic_settings import BaseSettings # # Settings # class Settings(BaseSettings): authorization_url: HttpUrl token_url: HttpUrl jwks_url: HttpUrl client_id: str permitted_jwt_audiences: List[str] = [\"account\"] settings = Settings( # Some example Cognito endpoints... authorization_url=\"https://example-app.auth.us-west-2.amazoncognito.com/oauth2/authorize\", token_url=\"https://example-app.auth.us-west-2.amazoncognito.com/oauth2/token\", jwks_url=\"https://cognito-idp.us-west-2.amazonaws.com/us-west-2_3x4mP1e1d/.well-known/jwks.json\", client_id='example-api' ) jwks_client = jwt.PyJWKClient(settings.jwks_url) # Caches JWKS # # Dependencies # oauth2_scheme = security.OAuth2AuthorizationCodeBearer( authorizationUrl=settings.authorization_url, tokenUrl=settings.token_url, scopes={ # Populate UI for scope selection checkboxes f\"example:{resource}:{action}\": f\"{action.title()} {resource}\" for resource in [\"note\"] for action in [\"create\", \"read\", \"update\", \"delete\"] }, ) def user_token( token_str: Annotated[str, Security(oauth2_scheme)], required_scopes: security.SecurityScopes, ): # Parse \u0026 validate token try: token = jwt.decode( token_str, jwks_client.get_signing_key_from_jwt(token_str).key, algorithms=[\"RS256\"], audience=settings.permitted_jwt_audiences, ) except Exception as e: raise HTTPException( status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Could not validate credentials\", headers={\"WWW-Authenticate\": \"Bearer\"}, ) from e # Validate scopes (if required) for scope in required_scopes.scopes: if scope not in token[\"scope\"]: raise HTTPException( status_code=status.HTTP_401_UNAUTHORIZED, detail=\"Not enough permissions\", headers={ \"WWW-Authenticate\": f'Bearer scope=\"{required_scopes.scope_str}\"' }, ) return token # # App # app = FastAPI( docs_url=\"/\", swagger_ui_init_oauth={ \"appName\": \"ExampleApp\", \"clientId\": settings.client_id, \"usePkceWithAuthorizationCodeGrant\": True, }, ) @app.get(\"/my-token\") def token(user_token: Annotated[Dict[Any, Any], Security(user_token)]): \"\"\"View auth token token.\"\"\" return user_token @app.get(\"/my-scopes\") def scopes(user_token: Annotated[Dict[Any, Any], Security(user_token)]): \"\"\"View auth token scopes.\"\"\" return user_token[\"scope\"].split(\" \") @app.get( \"/notes\", dependencies=[Security(user_token, scopes=[\"example:note:read\"])], ) def read_note(): \"\"\"Mock endpoint to read a note. Requires `example:note:read` scope.\"\"\" return { \"success\": True, \"details\": \"ðŸš€ You have the required scope to read a note\", } @app.post( \"/notes\", dependencies=[Security(user_token, scopes=[\"example:note:create\"])], ) def create_note(): \"\"\"Mock endpoint to create a note. Requires `example:note:create` scope.\"\"\" return { \"success\": True, \"details\": \"ðŸš€ You have the required scope to create a note\", } ","wordCount":"777","inLanguage":"en","datePublished":"2022-05-27T00:00:00Z","dateModified":"2022-05-27T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://alukach.com/posts/fastapi-rs256-jwt/"},"publisher":{"@type":"Organization","name":"anthony lukach","logo":{"@type":"ImageObject","url":"https://alukach.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://alukach.com/ accesskey=h title="anthony lukach (Alt + H)">anthony lukach</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu><li><a href=https://alukach.com/categories/posts title=Posts><span>Posts</span></a></li><li><a href=https://alukach.com/categories/snippets title=Snippets><span>Snippets</span></a></li><li><a href=https://alukach.com/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://alukach.com/resume title=RÃ©sumÃ©><span>RÃ©sumÃ©</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Securing FastAPI with JWKS (AWS Cognito, Auth0)</h1><div class=post-meta>&lt;span title='2022-05-27 00:00:00 +0000 UTC'>May 27, 2022&lt;/span>&amp;nbsp;Â·&amp;nbsp;4 min&nbsp;|&nbsp;<a href=https://github.com/alukach/alukach.github.io/edit/main/content/posts/fastapi-rs256-jwt.md rel="noopener noreferrer" target=_blank>Edit</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background-rs256 aria-label="Background: RS256">Background: RS256</a></li><li><a href=#background-jwks aria-label="Background: JWKS">Background: JWKS</a><ul><li><a href=#jwks-locations aria-label="JWKS Locations">JWKS Locations</a></li></ul></li><li><a href=#fastapi-integration aria-label="FastAPI Integration">FastAPI Integration</a></li></ul></div></details></div><div class=post-content><p>This post is a quick capture of how to easily secure your FastAPI with any auth provider that provides <a href=https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-key-sets>JWKS</a>.</p><h3 id=background-rs256>Background: RS256<a hidden class=anchor aria-hidden=true href=#background-rs256>#</a></h3><p>RS256 is a signing algorithm used to generate and validate JSON Web Tokens (JWTs). Unlike the common HS256 algorithm that uses the same secret string to both generate and validate JWTs, RS256 uses a private key to generate JWTs and a separate public key for validating JWTs:</p><blockquote><p>RS256 generates an asymmetric signature, which means a private key must be used to sign the JWT and a different public key must be used to verify the signature. [<a href=https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-key-sets>source</a>]</p></blockquote><p>This allows you to share your public key and thus enables any service to validate JWTs (provided that the service can read the public key). This makes RS256 a great choice for distributed applications, wherein one service generates auth tokens but many services can independently validate auth tokens.</p><p><em>Note:</em> You are already using asymmetric cryptographic algorithms. For example, when you access a website over HTTPS, the SSL certificate includes a public key to allow a browser to validate messages sent by the origin server, while the origin server maintains a private key used to sign messages before they are sent. Additionally, when you set up SSH key pair for the purpose of connecting to servers, this key pair consists of a <em>private</em> and <em>public</em> key. The private is kept on your machine while a public key can be stored in a <code>~/.ssh/authorized_keys</code> file on the server to validate login requests.</p><h3 id=background-jwks>Background: JWKS<a hidden class=anchor aria-hidden=true href=#background-jwks>#</a></h3><blockquote><p>The JSON Web Key Set (JWKS) is a set of keys containing the public keys used to verify any JSON Web Token (JWT) issued by the authorization server and signed using the RS256 <a href=https://auth0.com/docs/get-started/applications/signing-algorithms>signing algorithm</a>. [<a href=https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-key-sets>source</a>]</p></blockquote><p>The JWKS is needed by each service that will be validating tokens. It can be commonly be found at <code>/.well-known/jwks.json</code>, however theoretically could be distributed in any other means (S3, AWS Parameter Store, etc).</p><h4 id=jwks-locations>JWKS Locations<a hidden class=anchor aria-hidden=true href=#jwks-locations>#</a></h4><table><thead><tr><th>Provider</th><th>Location</th><th>Example</th></tr></thead><tbody><tr><td>Cognito</td><td><code>https://cognito-idp.{region}.amazonaws.com/{user_pool_id}/.well-known/jwks.json</code></td><td><a href=https://cognito-idp.us-east-1.amazonaws.com/us-east-1_Wt2sA2K9e/.well-known/jwks.json>https://cognito-idp.us-east-1.amazonaws.com/us-east-1_Wt2sA2K9e/.well-known/jwks.json</a></td></tr><tr><td>Auth0</td><td><code>https://YOUR_DOMAIN/.well-known/jwks.json</code></td><td><a href=https://example.auth0.com/.well-known/jwks.json>https://example.auth0.com/.well-known/jwks.json</a></td></tr></tbody></table><h3 id=fastapi-integration>FastAPI Integration<a hidden class=anchor aria-hidden=true href=#fastapi-integration>#</a></h3><p>For a FastAPI application to validate a JWT signed with an RS256 algorithm, it needs to do the following:</p><ol><li>Load JWKS</li><li>Retrieve token from the request</li><li>Validate the token&rsquo;s signature against the JWKS</li></ol><p>Below, I&rsquo;ve added a simple way to achieve this by taking advantage of <a href=https://fastapi.tiangolo.com/tutorial/dependencies/>FastAPI&rsquo;s dependency injection system</a> and <a href=https://pyjwt.readthedocs.io>pyJWT</a>:</p><div class=highlight><div style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#4d4d4d;background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>from</span> typing <span style=color:#2c5dcd;font-weight:700>import</span> Annotated, Any, Dict, List, Optional
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>import</span> jwt
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>from</span> fastapi <span style=color:#2c5dcd;font-weight:700>import</span> FastAPI, HTTPException, Security, security, status
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>from</span> pydantic <span style=color:#2c5dcd;font-weight:700>import</span> HttpUrl
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>from</span> pydantic_settings <span style=color:#2c5dcd;font-weight:700>import</span> BaseSettings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic># Settings</span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>class</span> <span style=text-decoration:underline>Settings</span>(BaseSettings):
</span></span><span style=display:flex><span>    authorization_url: HttpUrl
</span></span><span style=display:flex><span>    token_url: HttpUrl
</span></span><span style=display:flex><span>    jwks_url: HttpUrl
</span></span><span style=display:flex><span>    client_id: <span style=color:#5918bb;font-weight:700>str</span>
</span></span><span style=display:flex><span>    permitted_jwt_audiences: List[<span style=color:#5918bb;font-weight:700>str</span>] <span style=color:#2c5dcd>=</span> [<span style=color:#0c6>&#34;account&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>settings <span style=color:#2c5dcd>=</span> Settings(
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Some example Cognito endpoints...</span>
</span></span><span style=display:flex><span>    authorization_url<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;https://example-app.auth.us-west-2.amazoncognito.com/oauth2/authorize&#34;</span>,
</span></span><span style=display:flex><span>    token_url<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;https://example-app.auth.us-west-2.amazoncognito.com/oauth2/token&#34;</span>,
</span></span><span style=display:flex><span>    jwks_url<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;https://cognito-idp.us-west-2.amazonaws.com/us-west-2_3x4mP1e1d/.well-known/jwks.json&#34;</span>,
</span></span><span style=display:flex><span>    client_id<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#39;example-api&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>jwks_client <span style=color:#2c5dcd>=</span> jwt<span style=color:#2c5dcd>.</span>PyJWKClient(settings<span style=color:#2c5dcd>.</span>jwks_url)  <span style=color:#0080ff;font-style:italic># Caches JWKS</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic># Dependencies</span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic>#</span>
</span></span><span style=display:flex><span>oauth2_scheme <span style=color:#2c5dcd>=</span> security<span style=color:#2c5dcd>.</span>OAuth2AuthorizationCodeBearer(
</span></span><span style=display:flex><span>    authorizationUrl<span style=color:#2c5dcd>=</span>settings<span style=color:#2c5dcd>.</span>authorization_url,
</span></span><span style=display:flex><span>    tokenUrl<span style=color:#2c5dcd>=</span>settings<span style=color:#2c5dcd>.</span>token_url,
</span></span><span style=display:flex><span>    scopes<span style=color:#2c5dcd>=</span>{ <span style=color:#0080ff;font-style:italic># Populate UI for scope selection checkboxes</span>
</span></span><span style=display:flex><span>        <span style=color:#0c6>f</span><span style=color:#0c6>&#34;example:</span><span style=color:#0c6>{</span>resource<span style=color:#0c6>}</span><span style=color:#0c6>:</span><span style=color:#0c6>{</span>action<span style=color:#0c6>}</span><span style=color:#0c6>&#34;</span>: <span style=color:#0c6>f</span><span style=color:#0c6>&#34;</span><span style=color:#0c6>{</span>action<span style=color:#2c5dcd>.</span>title()<span style=color:#0c6>}</span><span style=color:#0c6> </span><span style=color:#0c6>{</span>resource<span style=color:#0c6>}</span><span style=color:#0c6>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>for</span> resource <span style=color:#2c5dcd;font-weight:700>in</span> [<span style=color:#0c6>&#34;note&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>for</span> action <span style=color:#2c5dcd;font-weight:700>in</span> [<span style=color:#0c6>&#34;create&#34;</span>, <span style=color:#0c6>&#34;read&#34;</span>, <span style=color:#0c6>&#34;update&#34;</span>, <span style=color:#0c6>&#34;delete&#34;</span>]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>user_token</span>(
</span></span><span style=display:flex><span>    token_str: Annotated[<span style=color:#5918bb;font-weight:700>str</span>, Security(oauth2_scheme)],
</span></span><span style=display:flex><span>    required_scopes: security<span style=color:#2c5dcd>.</span>SecurityScopes,
</span></span><span style=display:flex><span>):
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Parse &amp; validate token</span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>try</span>:
</span></span><span style=display:flex><span>        token <span style=color:#2c5dcd>=</span> jwt<span style=color:#2c5dcd>.</span>decode(
</span></span><span style=display:flex><span>            token_str,
</span></span><span style=display:flex><span>            jwks_client<span style=color:#2c5dcd>.</span>get_signing_key_from_jwt(token_str)<span style=color:#2c5dcd>.</span>key,
</span></span><span style=display:flex><span>            algorithms<span style=color:#2c5dcd>=</span>[<span style=color:#0c6>&#34;RS256&#34;</span>],
</span></span><span style=display:flex><span>            audience<span style=color:#2c5dcd>=</span>settings<span style=color:#2c5dcd>.</span>permitted_jwt_audiences,
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>except</span> <span style=color:#5918bb;font-weight:700>Exception</span> <span style=color:#2c5dcd;font-weight:700>as</span> e:
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>raise</span> HTTPException(
</span></span><span style=display:flex><span>            status_code<span style=color:#2c5dcd>=</span>status<span style=color:#2c5dcd>.</span>HTTP_401_UNAUTHORIZED,
</span></span><span style=display:flex><span>            detail<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Could not validate credentials&#34;</span>,
</span></span><span style=display:flex><span>            headers<span style=color:#2c5dcd>=</span>{<span style=color:#0c6>&#34;WWW-Authenticate&#34;</span>: <span style=color:#0c6>&#34;Bearer&#34;</span>},
</span></span><span style=display:flex><span>        ) <span style=color:#2c5dcd;font-weight:700>from</span> e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#0080ff;font-style:italic># Validate scopes (if required)</span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>for</span> scope <span style=color:#2c5dcd;font-weight:700>in</span> required_scopes<span style=color:#2c5dcd>.</span>scopes:
</span></span><span style=display:flex><span>        <span style=color:#2c5dcd;font-weight:700>if</span> scope <span style=color:#2c5dcd;font-weight:700>not</span> <span style=color:#2c5dcd;font-weight:700>in</span> token[<span style=color:#0c6>&#34;scope&#34;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#2c5dcd;font-weight:700>raise</span> HTTPException(
</span></span><span style=display:flex><span>                status_code<span style=color:#2c5dcd>=</span>status<span style=color:#2c5dcd>.</span>HTTP_401_UNAUTHORIZED,
</span></span><span style=display:flex><span>                detail<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;Not enough permissions&#34;</span>,
</span></span><span style=display:flex><span>                headers<span style=color:#2c5dcd>=</span>{
</span></span><span style=display:flex><span>                    <span style=color:#0c6>&#34;WWW-Authenticate&#34;</span>: <span style=color:#0c6>f</span><span style=color:#0c6>&#39;Bearer scope=&#34;</span><span style=color:#0c6>{</span>required_scopes<span style=color:#2c5dcd>.</span>scope_str<span style=color:#0c6>}</span><span style=color:#0c6>&#34;&#39;</span>
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> token
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic># App</span>
</span></span><span style=display:flex><span><span style=color:#0080ff;font-style:italic>#</span>
</span></span><span style=display:flex><span>app <span style=color:#2c5dcd>=</span> FastAPI(
</span></span><span style=display:flex><span>    docs_url<span style=color:#2c5dcd>=</span><span style=color:#0c6>&#34;/&#34;</span>,
</span></span><span style=display:flex><span>    swagger_ui_init_oauth<span style=color:#2c5dcd>=</span>{
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;appName&#34;</span>: <span style=color:#0c6>&#34;ExampleApp&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;clientId&#34;</span>: settings<span style=color:#2c5dcd>.</span>client_id,
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;usePkceWithAuthorizationCodeGrant&#34;</span>: <span style=color:#2c5dcd;font-weight:700>True</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff8000;font-weight:700>@app.get</span>(<span style=color:#0c6>&#34;/my-token&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>token</span>(user_token: Annotated[Dict[Any, Any], Security(user_token)]):
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;&#34;&#34;View auth token token.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> user_token
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff8000;font-weight:700>@app.get</span>(<span style=color:#0c6>&#34;/my-scopes&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>scopes</span>(user_token: Annotated[Dict[Any, Any], Security(user_token)]):
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;&#34;&#34;View auth token scopes.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> user_token[<span style=color:#0c6>&#34;scope&#34;</span>]<span style=color:#2c5dcd>.</span>split(<span style=color:#0c6>&#34; &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff8000;font-weight:700>@app.get</span>(
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;/notes&#34;</span>,
</span></span><span style=display:flex><span>    dependencies<span style=color:#2c5dcd>=</span>[Security(user_token, scopes<span style=color:#2c5dcd>=</span>[<span style=color:#0c6>&#34;example:note:read&#34;</span>])],
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>read_note</span>():
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;&#34;&#34;Mock endpoint to read a note. Requires `example:note:read` scope.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;success&#34;</span>: <span style=color:#2c5dcd;font-weight:700>True</span>,
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;details&#34;</span>: <span style=color:#0c6>&#34;ðŸš€ You have the required scope to read a note&#34;</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff8000;font-weight:700>@app.post</span>(
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;/notes&#34;</span>,
</span></span><span style=display:flex><span>    dependencies<span style=color:#2c5dcd>=</span>[Security(user_token, scopes<span style=color:#2c5dcd>=</span>[<span style=color:#0c6>&#34;example:note:create&#34;</span>])],
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#2c5dcd;font-weight:700>def</span> <span style=color:#ff8000;font-weight:700>create_note</span>():
</span></span><span style=display:flex><span>    <span style=color:#0c6>&#34;&#34;&#34;Mock endpoint to create a note. Requires `example:note:create` scope.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#2c5dcd;font-weight:700>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;success&#34;</span>: <span style=color:#2c5dcd;font-weight:700>True</span>,
</span></span><span style=display:flex><span>        <span style=color:#0c6>&#34;details&#34;</span>: <span style=color:#0c6>&#34;ðŸš€ You have the required scope to create a note&#34;</span>,
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://alukach.com/tags/auth/>Auth</a></li><li><a href=https://alukach.com/tags/fastapi/>Fastapi</a></li><li><a href=https://alukach.com/tags/python/>Python</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://alukach.com/>anthony lukach</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>